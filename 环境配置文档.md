# 传感器监控应用程序环境配置文档

## 项目概述

SensorMonitorApp 是一个基于 C++17 的实时传感器数据监控应用程序，使用 ImGui 创建图形界面，通过 ZeroMQ 进行网络通信，支持多通道传感器数据的实时显示和监控。

## 系统要求

### 操作系统
- Windows 10/11
- Linux (Ubuntu 18.04+)
- macOS (10.14+)

### 编译环境
- CMake 3.15 或更高版本
- C++17 兼容的编译器
  - GCC 9.0+
  - Clang 9.0+
  - MSVC 19.2+ (Visual Studio 2019)

### 依赖库

#### 核心依赖
1. **GLFW3** - OpenGL 窗口管理库
2. **OpenGL** - 图形渲染库
3. **GLAD** - OpenGL 函数指针加载器
4. **ImGui** - 立即模式图形用户界面库
5. **ZeroMQ** - 高性能异步消息库
6. **nlohmann/json** - JSON 处理库

#### 可选依赖
- **vcpkg** - C++ 包管理器（推荐用于依赖管理）

## 安装配置

### 方法一：使用 vcpkg（推荐）

#### 1. 安装 vcpkg
```bash
# 克隆 vcpkg 仓库
git clone https://github.com/microsoft/vcpkg.git
cd vcpkg

# 编译 vcpkg
./bootstrap-vcpkg.sh  # Linux/macOS
.\bootstrap-vcpkg.bat  # Windows
```

#### 2. 安装依赖库
```bash
# 安装所有必需的依赖库
./vcpkg install glfw3 nlohmann-json zeromq glad

# 或者分别安装
./vcpkg install glfw3
./vcpkg install nlohmann-json
./vcpkg install zeromq
./vcpkg install glad
```

#### 3. 配置 CMake
```bash
# 创建构建目录
mkdir build && cd build

# 配置项目
cmake .. -DCMAKE_TOOLCHAIN_FILE=/path/to/vcpkg/scripts/buildsystems/vcpkg.cmake
```

### 方法二：手动安装依赖

#### 1. GLFW3
```bash
# Ubuntu/Debian
sudo apt-get install libglfw3-dev

# macOS (使用 Homebrew)
brew install glfw

# Windows (从官网下载)
# 下载 GLFW 并添加到系统路径
```

#### 2. ZeroMQ
```bash
# Ubuntu/Debian
sudo apt-get install libzmq3-dev

# macOS (使用 Homebrew)
brew install zeromq

# Windows (使用 vcpkg 或手动编译)
```

#### 3. nlohmann/json
```bash
# 下载头文件
wget https://github.com/nlohmann/json/releases/latest/download/json.hpp -O include/json.hpp
```

#### 4. OpenGL/GLAD
```bash
# 安装 OpenGL 开发库
# Ubuntu/Debian
sudo apt-get install libgl1-mesa-dev libglu1-mesa-dev

# macOS
brew install glew

# Windows
# 安装 OpenGL SDK 和 GLAD
```

## 构建项目

### Windows (使用 CMake)
```bash
# 创建构建目录
mkdir build
cd build

# 配置项目
cmake .. -DCMAKE_TOOLCHAIN_FILE=C:/path/to/vcpkg/scripts/buildsystems/vcpkg.cmake

# 编译项目
cmake --build . --config Release

# 运行程序
.\Release\SensorMonitor.exe
```

### Linux/macOS
```bash
# 创建构建目录
mkdir build
cd build

# 配置项目
cmake .. -DCMAKE_TOOLCHAIN_FILE=/path/to/vcpkg/scripts/buildsystems/vcpkg.cmake

# 编译项目
cmake --build .

# 运行程序
./SensorMonitor
```

## 网络配置

### ZeroMQ 服务器配置
应用程序监听端口：`5555`
```bash
# 启动服务器
tcp://*:5555
```

### 数据包格式
- **通道数量**: 128
- **每个数据包采样点数**: 8
- **数据包大小**: 4096 字节 (4 * 128 * 8)
- **数据类型**: float32

### 端口配置
在 `src/main.cpp:103` 中修改监听地址：
```cpp
const std::string ADDRESS = "tcp://*:5555";  // 修改端口号或地址
```

## 运行应用程序

### 启动监控程序
```bash
# Windows
.\SensorMonitor.exe

# Linux/macOS
./SensorMonitor
```

### 程序功能
1. **实时数据接收**: 通过 ZeroMQ 接收传感器数据
2. **图表显示**: 显示温度和湿度数据的实时图表
3. **数据缓存**: 缓存接收到的采样数据
4. **数据保存**: 程序退出时自动保存数据到文件

## 文件结构

```
SensorMonitorApp/
├── CMakeLists.txt              # CMake 配置文件
├── src/
│   ├── main.cpp                # 主程序入口
│   ├── Core/                   # 核心功能模块
│   ├── IO/                     # 输入输出模块
│   └── UI/                     # 用户界面模块
├── include/                    # 头文件目录
├── third_party/                # 第三方库
│   ├── imgui/                  # ImGui 源码
│   └── glad/                   # GLAD 源码
├── vcpkg/                      # vcpkg 包管理器
└── build/                      # 构建目录
```

## 故障排除

### 常见问题

#### 1. CMake 配置错误
```bash
# 检查 CMake 版本
cmake --version

# 确保 vcpkg 工具链文件路径正确
ls /path/to/vcpkg/scripts/buildsystems/vcpkg.cmake
```

#### 2. 链接错误
```bash
# 确保所有依赖库已正确安装
# 检查 vcpkg 安装状态
./vcpkg list
```

#### 3. ZeroMQ 连接问题
```bash
# 检查端口是否被占用
netstat -an | grep 5555

# 确保防火墙允许 5555 端口
```

#### 4. OpenGL 相关错误
```bash
# 确保 OpenGL 版本支持 3.3+
glxinfo | grep OpenGL
```

### 调试模式
```bash
# 编译调试版本
cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_TOOLCHAIN_FILE=/path/to/vcpkg/scripts/buildsystems/vcpkg.cmake

# 使用调试器运行
gdb ./SensorMonitor
```

## 性能优化

### 1. 数据缓存优化
- 每个通道最大缓存样本数：10,000
- 预分配内存减少动态分配开销

### 2. 渲染优化
- 使用 OpenGL 3.3 核心模式
- 垂直同步开启
- 非阻塞数据接收

### 3. 内存管理
- 使用向量预分配内存
- 及时清理过期数据

## 更新和维护

### 更新依赖库
```bash
# 更新 vcpkg
cd vcpkg
git pull
./vcpkg update

# 重新编译项目
cd ../build
cmake .. && make
```

### 代码风格
- 遵循 C++17 标准
- 使用现代 C++ 特性
- 保持一致的命名规范

## 联系支持

如有问题或建议，请查看：
1. 项目文档
2. 代码注释
3. 错误日志输出

---
*最后更新：2024年*